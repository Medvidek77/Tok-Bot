const Discord = require('discord.js');
const client = new Discord.Client();
const prefix = "!"; // mÅ¯Å¾ete zmÄ›nit prefix na svÅ¯j vlastnÃ­

const TOKEN = 'insert-bot-token-here';
const channelId = 'insert-channel-id-here';
const scoreFile = './scores.json';

client.on('ready', () => {
  console.log(`Logged in as ${client.user.tag}`);
});

client.on('message', async (message) => {
  if (!message.content.startsWith(prefix) && message.channel.type !== 'dm') {
    const scores = JSON.parse(fs.readFileSync(scoreFile, 'utf-8'));
    const userId = message.author.id;
    if (!scores[userId]) {
      scores[userId] = 0;
    }
    scores[userId]++;
    fs.writeFileSync(scoreFile, JSON.stringify(scores));
    const messageCount = Object.values(scores).reduce((a, b) => a + b, 0);
    if (messageCount % 20 === 0) {
      const embed = new Discord.MessageEmbed()
        .setTitle('NovÃ© velikonoÄnÃ­ vajÃ­Äko!')
        .setDescription('Gratulujeme, prÃ¡vÄ› jste napsali 20 zprÃ¡v a zÃ­skali jste novÃ© vajÃ­Äko!')
        .setColor('#FFC0CB')
        .setImage('https://i.imgur.com/QJLPbWA.png')
        .setFooter('StisknutÃ­m tlaÄÃ­tka "Vezmi" obdrÅ¾Ã­te 1 bod.', client.user.avatarURL());

      const filter = (reaction, user) => reaction.emoji.name === 'ğŸ¥š' && user.id === userId;
      const collector = message.channel.createMessageCollector(filter, { time: 10000 });

      const sentEmbed = await message.channel.send(embed);
      await sentEmbed.react('ğŸ¥š');

      collector.on('collect', (reaction, user) => {
        scores[user.id]++;
        fs.writeFileSync(scoreFile, JSON.stringify(scores));
        sentEmbed.delete();
        message.channel.send(`${user} zÃ­skal bod za sbÄ›r vajÃ­Äka! Celkem mÃ¡ ${scores[user.id]} bodÅ¯.`);
      });

      collector.on('end', (collected, reason) => {
        if (reason === 'time') {
          sentEmbed.delete();
          message.channel.send('VyprÅ¡el ÄasovÃ½ limit pro sbÄ›r vajÃ­Äka.');
        }
      });
    }
  }
});

client.login(TOKEN);
